<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Real Apk - Apps</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Small custom tweaks to better match reference */
    :root{
      --bg:#0f1724;       /* deep navy */
      --card:#172033;     /* card bg */
      --muted:#9aa4b2;    /* muted text */
      --accent:#6ea8ff;   /* accent blue */
      --pill:#24303c;
    }
    body { background:var(--bg); color:#e6eef8; font-family:Inter, system-ui, Arial; }
    .card-shadow{ box-shadow: 0 10px 25px rgba(2,6,23,0.6); }
    /* big rounded cards */
    .round-card { border-radius: 20px; background: var(--card); padding:16px; }
    /* featured large card */
    .featured-card { min-width:320px; max-width:420px; border-radius:18px; padding:18px; }
    .soft-pill { background:var(--pill); padding:6px 10px; border-radius:999px; color:var(--muted); font-weight:600; }
    .btn-primary { background:linear-gradient(180deg,#6ea8ff,#3b82f6); color:white; padding:8px 14px; border-radius:10px; font-weight:700; display:inline-block; }
    /* search pill in header */
    .search-pill{ background:var(--card); border-radius:999px; padding:10px 14px; display:flex; gap:8px; align-items:center; min-width:220px; }
    /* loader */
    .loader { width:72px; height:72px; border-radius:50%; border:8px solid rgba(255,255,255,0.08); border-top-color: #6ea8ff; animation:spin 1s linear infinite; margin: 18px auto; }
    @keyframes spin{ to { transform: rotate(360deg);} }
    /* responsive tweaks */
    @media (max-width:640px){
      .featured-card{ min-width:280px; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React + Babel for single-file -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"></script>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script type="text/babel">
  const { useState, useEffect, useRef } = React;

  /***********************
   * FIREBASE CONFIG - inserted
   ***********************/
  const FIREBASE_CONFIG = {
    apiKey: "AIzaSyDAoDGn6lymDsAia_SNue37MiyfD80pFKU",
    authDomain: "website-builder-e975c.firebaseapp.com",
    projectId: "website-builder-e975c",
    storageBucket: "website-builder-e975c.firebasestorage.app",
    messagingSenderId: "200054863866",
    appId: "1:200054863866:web:fe88010678557c7f9f9643",
    measurementId: "G-84KLJLYTPZ"
  };

  firebase.initializeApp(FIREBASE_CONFIG);
  const db = firebase.firestore();

  /***********************
   * Helper: detect download hash
   ***********************/
  function getDownloadHash(){
    const h = window.location.hash || '';
    if(h.startsWith('#dl:')) return h.slice(4);
    return null;
  }

  /***********************
   * App component
   ***********************/
  function App(){
    const [apps, setApps] = useState([]);
    const [featured, setFeatured] = useState([]);
    const [loading, setLoading] = useState(true);
    const [search, setSearch] = useState('');
    const dlId = getDownloadHash();

    useEffect(()=>{
      // subscribe to apps
      const unsub = db.collection('apps').orderBy('createdAt','desc')
        .onSnapshot(snap=>{
          const arr=[];
          snap.forEach(d=>arr.push({id:d.id, ...d.data()}));
          setApps(arr);
          setFeatured(arr.filter(a=>a.isFeatured).slice(0,10));
          setLoading(false);
        }, err=>{ console.error(err); setLoading(false); });
      return ()=>unsub();
    },[]);

    // if hash contains download id, show Download page
    if(dlId){
      return <DownloadPage id={dlId} />;
    }

    const filtered = apps.filter(a=>{
      if(!search) return true;
      const s=search.toLowerCase();
      return (a.name||'').toLowerCase().includes(s) || (a.description||'').toLowerCase().includes(s);
    });

    return (
      <div className="min-h-screen max-w-3xl mx-auto p-4">
        <Header onSearch={setSearch} />

        <main className="mt-6">
          {/* Featured */}
          <section>
            <div className="flex items-center justify-between">
              <div>
                <h2 style={{fontSize:26,fontWeight:800}}>ðŸ”¥ Featured Apps</h2>
                <div style={{color:'var(--muted)'}}>Premium Selections</div>
              </div>
              <div className="soft-pill">Featured</div>
            </div>

            <div className="mt-4 flex gap-4 overflow-x-auto pb-4">
              {featured.length === 0 && <div style={{color:'var(--muted)'}}>No featured apps</div>}
              {featured.map(app=>(
                <div key={app.id} className="featured-card card-shadow round-card" style={{display:'flex', flexDirection:'column', justifyContent:'space-between', minWidth:360}}>
                  <div style={{display:'flex', gap:14, alignItems:'center'}}>
                    <img src={app.logo} alt="" style={{width:72,height:72,borderRadius:12,objectFit:'cover',background:'#0b1220'}} onError={(e)=>e.target.src='https://via.placeholder.com/72'} />
                    <div style={{flex:1}}>
                      <div style={{fontWeight:800,fontSize:18}}>{app.name}</div>
                      <div style={{color:'var(--muted)',marginTop:6}}>{app.description}</div>
                      <div style={{marginTop:8}}><span className="soft-pill" style={{fontSize:12}}>{app.type || 'Original'}</span></div>
                    </div>
                    <div style={{textAlign:'right'}}>
                      <div style={{fontWeight:700,color:'#ffd166'}}>â˜… {app.rating || 'â€”'}</div>
                    </div>
                  </div>

                  <div style={{marginTop:14, display:'flex', justifyContent:'space-between', alignItems:'center'}}>
                    <div style={{color:'var(--muted)', fontSize:13}}>v{app.version || ''}</div>
                    <div>
                      <a className="btn-primary" href="#" onClick={(e)=>{ e.preventDefault(); openDownloadTab(app.id); }}>DOWNLOAD</a>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </section>

          {/* Info pills */}
          <div className="mt-6 grid grid-cols-3 gap-3">
            <div className="round-card text-center card-shadow">
              <div style={{fontWeight:700,fontSize:18}}>5+</div>
              <div style={{color:'var(--muted)'}}>Total Apps</div>
            </div>
            <div className="round-card text-center card-shadow">
              <div style={{fontWeight:700,fontSize:18}}>3+</div>
              <div style={{color:'var(--muted)'}}>MOD Apps</div>
            </div>
            <div className="round-card text-center card-shadow">
              <div style={{fontWeight:700,fontSize:18}}>10+</div>
              <div style={{color:'var(--muted)'}}>Daily Updates</div>
            </div>
          </div>

          {/* All apps */}
          <section className="mt-8">
            <div style={{display:'flex', justifyContent:'space-between', alignItems:'center'}}>
              <div>
                <h3 style={{fontSize:22,fontWeight:800}}>All Apps</h3>
                <div style={{color:'var(--muted)'}}>Explore Everything</div>
              </div>
              <div style={{width:220}} />
            </div>

            <div className="mt-4 grid gap-4">
              {loading && <div style={{color:'var(--muted)'}}>Loading...</div>}
              {filtered.map(app=>(
                <div key={app.id} className="p-4 round-card card-shadow" style={{display:'flex', alignItems:'center', gap:16}}>
                  <img src={app.logo} style={{width:78,height:78,borderRadius:14,objectFit:'cover'}} onError={(e)=>e.target.src='https://via.placeholder.com/78'} />
                  <div style={{flex:1}}>
                    <div style={{fontWeight:800, fontSize:16}}>{app.name} <span style={{marginLeft:8, padding:'4px 8px', background:'#ef476f', borderRadius:8, fontSize:12, color:'#fff'}}>{app.type}</span></div>
                    <div style={{color:'var(--muted)', marginTop:6}}>{app.description}</div>
                    <div style={{color:'var(--muted)', marginTop:6, fontSize:13}}>v{app.version || ''}</div>
                  </div>

                  <div style={{textAlign:'right'}}>
                    <div style={{marginBottom:10, fontWeight:700, color:'#ffd166'}}>{app.rating || 'â€”'} â˜…</div>
                    <a className="btn-primary" href="#" onClick={(e)=>{ e.preventDefault(); openDownloadTab(app.id); }}>Download</a>
                  </div>
                </div>
              ))}
            </div>
          </section>
        </main>

      </div>
    );
  }

  /***********************
   * Header: name changed to Real Apk, search in right
   ***********************/
  function Header({onSearch}){
    const [q, setQ] = useState('');
    useEffect(()=>{ onSearch(q); },[q]);
    return (
      <header style={{display:'flex', alignItems:'center', justifyContent:'space-between', gap:12}}>
        <div style={{display:'flex', alignItems:'center', gap:12}}>
          <div style={{width:44,height:44,borderRadius:40, background:'#6b21a8'}}></div>
          <div style={{fontSize:20,fontWeight:900}}>Real Apk</div>
        </div>

        <div className="search-pill">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="#9aa4b2" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><circle cx="11" cy="11" r="6" stroke="#9aa4b2" strokeWidth="2" /></svg>
          <input placeholder="Search apps..." value={q} onChange={(e)=>setQ(e.target.value)} style={{background:'transparent', border:'none', outline:'none', color:'white'}} />
        </div>
      </header>
    );
  }

  /***********************
   * Download flow: opens new tab with hash #dl:<id>
   * This component runs when location.hash starts with #dl:
   ***********************/
  function DownloadPage({id}){
    const [app, setApp] = useState(null);
    const [seconds, setSeconds] = useState(3);

    useEffect(()=>{
      let mounted = true;
      db.collection('apps').doc(id).get().then(doc=>{
        if(!mounted) return;
        if(doc.exists) setApp({id:doc.id, ...doc.data()});
        else setApp(null);
      }).catch(()=>setApp(null));

      // countdown
      const iv = setInterval(()=> setSeconds(s => {
        if(s<=1){ clearInterval(iv); return 0; }
        return s-1;
      }), 1000);

      // after 3s redirect to apkLink (if present)
      const t = setTimeout(()=>{
        db.collection('apps').doc(id).get().then(doc=>{
          if(!doc.exists) { window.location.href = '/'; return; }
          const data = doc.data();
          if(data && data.apkLink){
            // If it's an external link, go there
            window.location.href = data.apkLink;
          } else {
            // no link -> back to home
            window.location.href = '/';
          }
        }).catch(()=> window.location.href = '/');
      }, 3000);

      return ()=>{ mounted=false; clearTimeout(t); clearInterval(iv); };
    },[id]);

    return (
      <div style={{minHeight:'100vh',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',padding:24, background: 'linear-gradient(180deg,#071029,#0b1220)'}}>
        <div style={{maxWidth:520, width:'100%', textAlign:'center', background:'rgba(255,255,255,0.02)', padding:26, borderRadius:16}}>
          <div style={{fontWeight:900, fontSize:22}}>Preparing your download...</div>
          <div style={{color:'var(--muted)', marginTop:8}}>We will redirect you shortly</div>

          <div style={{marginTop:18}}>
            <div className="loader"></div>
          </div>

          <div style={{marginTop:12, fontWeight:700}}>{ seconds > 0 ? `Redirecting in ${seconds}s` : 'Redirecting...' }</div>

          {app && <div style={{marginTop:18, display:'flex', alignItems:'center', gap:12, justifyContent:'center'}}>
            <img src={app.logo} style={{width:56,height:56,borderRadius:10,objectFit:'cover'}} onError={(e)=>e.target.src='https://via.placeholder.com/56'} />
            <div style={{textAlign:'left'}}>
              <div style={{fontWeight:800}}>{app.name}</div>
              <div style={{color:'var(--muted)'}}>Opening download link...</div>
            </div>
          </div>}
        </div>
      </div>
    );
  }

  /***********************
   * openDownloadTab helper
   ***********************/
  function openDownloadTab(id){
    // Open a new tab with hash. The same app will run and show DownloadPage for that id.
    const url = window.location.origin + window.location.pathname + '#dl:' + id;
    window.open(url, '_blank');
  }

  ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>

  <!-- small usage note:
    - To access admin panel (unchanged): append #adminsecret to url (e.g., index.html#adminsecret)
    - Download opens new tab with #dl:<appId>, shows loader then redirects to apkLink
  -->
</body>
</html>